<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Instaplant Admin Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Segoe UI,Arial,sans-serif}
body{margin:0;background:#f3f6f4}

/* LOGIN */
.login{
  height:100vh;display:flex;justify-content:center;align-items:center
}
.login-box{
  background:#fff;padding:2.5rem;border-radius:18px;
  box-shadow:0 12px 35px rgba(0,0,0,.15);
  text-align:center
}
.login-box h2{color:#1b5e20}
.login-box button{
  padding:.8rem 1.8rem;border:none;border-radius:12px;
  background:#1b5e20;color:white;font-size:1rem;cursor:pointer
}
.hidden{display:none}

/* HEADER */
.header{
  background:white;padding:1rem 2rem;
  display:flex;justify-content:space-between;align-items:center;
  box-shadow:0 4px 15px rgba(0,0,0,.1)
}
.header h2{color:#1b5e20}
.header button{
  padding:.5rem 1rem;border:none;border-radius:8px;
  background:#c62828;color:white;cursor:pointer
}

/* DASHBOARD */
.dashboard{padding:2rem}
.cards{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:1.2rem;margin-bottom:2rem
}
.card{
  background:white;padding:1.2rem;border-radius:16px;
  box-shadow:0 8px 25px rgba(0,0,0,.1)
}
.card h3{margin:0;color:#1b5e20}
.card p{font-size:1.5rem;font-weight:bold}

/* FILTER BAR */
.filters{
  display:flex;gap:10px;margin-bottom:1.5rem;flex-wrap:wrap
}
.filters input,.filters select{
  padding:.7rem;border-radius:10px;border:1px solid #ccc
}

/* MAIN */
.main{
  display:grid;grid-template-columns:2fr 1fr;gap:20px
}

/* ORDERS */
.orders{
  background:white;border-radius:18px;padding:1rem;
  box-shadow:0 10px 30px rgba(0,0,0,.12)
}
.order{
  display:flex;justify-content:space-between;align-items:center;
  background:#f9faf9;padding:12px;border-radius:12px;
  margin-bottom:10px
}
.order strong{display:block}
.small{font-size:.85rem;color:#555}

/* STATUS */
.pending{color:#f59e0b;font-weight:bold}
.accepted{color:#16a34a;font-weight:bold}
.shipped{color:#2563eb;font-weight:bold}
.rejected{color:#dc2626;font-weight:bold}

/* BUTTONS */
.btns button{
  border:none;border-radius:8px;padding:6px 10px;
  margin-left:4px;font-size:.75rem;cursor:pointer
}
.view{background:#e5e7eb}
.accept{background:#d1fae5}
.ship{background:#bfdbfe}
.reject{background:#fee2e2}
.delete{background:#ef4444;color:white}


/* SIDE */
.side{
  background:white;border-radius:18px;padding:1.2rem;
  box-shadow:0 10px 30px rgba(0,0,0,.12)
}
.side{
  background:white;border-radius:18px;padding:1.2rem;
  box-shadow:0 10px 30px rgba(0,0,0,.12)
}
/* INVENTORY INPUTS */
.orders input{
  width:100%;
  padding:.7rem;
  margin:.4rem 0;
  border-radius:10px;
  border:1px solid #ccc;
}
.header button{
  margin-left:8px;
}
/* ================= INVENTORY PROFESSIONAL UI ================= */

.inventory-header{
  padding:2rem;
}
.inventory-header h2{
  margin:0;
  color:#1b5e20;
}
.inventory-header p{
  margin:.3rem 0 0;
  color:#555;
  font-size:.9rem;
}

.inventory-grid{
  display:grid;
  grid-template-columns:1fr 1.4fr;
  gap:25px;
  padding:0 2rem 2rem;
}

.inventory-card{
  background:white;
  padding:1.6rem;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
}

.inventory-card h3{
  margin-top:0;
  margin-bottom:1rem;
  color:#1b5e20;
}

.inventory-card label{
  display:block;
  font-size:.85rem;
  color:#555;
  margin-top:.8rem;
}

.inventory-card input{
  width:100%;
  padding:.7rem;
  margin-top:.3rem;
  border-radius:10px;
  border:1px solid #ccc;
  outline:none;
}

.inventory-card input:focus{
  border-color:#1b5e20;
}

.inventory-save{
  margin-top:1.2rem;
  width:100%;
  padding:.8rem;
  border:none;
  border-radius:12px;
  background:#1b5e20;
  color:white;
  font-size:1rem;
  cursor:pointer;
}

.inventory-save:hover{
  background:#145a18;
}

/* plant rows */
#plantsList .order{
  background:#f9faf9;
  border-radius:12px;
}
.delivered{
  color:#0f766e;
  font-weight:bold;
}

/* ================= VIEW ORDER PANEL ================= */

#details{
  background:#f9faf9;
  padding:1.2rem;
  border-radius:14px;
  line-height:1.6;
  font-size:.95rem;
  color:#333;
}

/* Customer name */
#details strong{
  font-size:1.05rem;
  color:#1b5e20;
  display:block;
  margin-bottom:.4rem;
}

/* Info rows */
#details br{
  line-height:1.8;
}

/* Items list */
#details ul{
  padding-left:18px;
  margin:10px 0 0;
}

#details li{
  margin-bottom:6px;
  font-size:.9rem;
}

/* Icons spacing */
#details span,
#details div{
  display:block;
}

/* Empty state */
#details:empty{
  color:#777;
  font-style:italic;
}

/* ================= MOBILE OPTIMIZATION ================= */
@media(max-width:768px){
  #details{
    padding:1rem;
    font-size:.9rem;
  }
}
select {
  width: 100%;
  padding: .7rem;
  margin-top: .3rem;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: .9rem;
  outline: none;
  background: white;
}

select:focus {
  border-color: #1b5e20;
}

</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="login">
  <div class="login-box">
    <h2>üåø Instaplant Admin</h2>
    <p>Sign in with Google</p>
    <button onclick="googleLogin()">Sign in with Google</button>
  </div>
</div>

<!-- ADMIN DASHBOARD -->
<div id="admin" class="hidden">

  <div class="header">
    <div>
      <h2>GreenLeaf Admin Dashboard</h2>
      <small id="adminName" style="color:#555;font-size:.85rem">
        Logged in as Admin
      </small>
    </div>

    <div style="display:flex;gap:10px;align-items:center">
      <button onclick="openOrders()" style="background:#1b5e20;color:white">
        Orders
      </button>

      <button onclick="openInventory()" style="background:#2e7d32;color:white">
        Inventory
      </button>

      <button onclick="logout()" style="background:#c62828;color:white">
        Logout
      </button>
    </div>
  </div>
</div> <!-- end of #admin -->



<div class="dashboard">

<div class="cards">
  <div class="card"><h3>Total Orders</h3><p id="tTotal">0</p></div>
  <div class="card"><h3>Pending</h3><p id="tPending">0</p></div>
  <div class="card"><h3>Accepted</h3><p id="tAccepted">0</p></div>
  <div class="card"><h3>Shipped</h3><p id="tShipped">0</p></div>
  <div class="card"><h3>Delivered</h3><p id="tDelivered">0</p></div>

</div>

<<div class="filters">
  <input id="search" placeholder="Search name / phone / order ID">

  <select id="filter">
    <option value="all">All Status</option>
    <option value="pending">Pending</option>
    <option value="accepted">Accepted</option>
    <option value="shipped">Shipped</option>
    <option value="rejected">Rejected</option>
    <option value="delivered">Delivered</option>
  </select>

  <button onclick="downloadOrders()" style="
    padding:.7rem 1.2rem;
    border:none;
    border-radius:10px;
    background:#1b5e20;
    color:white;
    cursor:pointer;
  ">
    ‚¨á Download Orders
  </button>
</div>


<div class="main">

<div class="orders">
  <h3>Orders</h3>
  <div id="ordersList">Loading‚Ä¶</div>
</div>

<div class="side">
  <h3>Order Details</h3>
  <div id="details">Select an order</div>
</div>

</div>
</div>
</div>
<div id="inventorySection" class="hidden">

  <div class="inventory-header">
    <h2>üå± Inventory Management</h2>
    <p>Manage plants, pricing and stock</p>
  </div>

  <div class="inventory-grid">

    <!-- FORM CARD -->
    <div class="inventory-card">
      <h3>Add / Update Plant</h3>

      <label>Plant Name</label>
      <input id="pName" placeholder="e.g. Money Plant">

      <label>Price (‚Çπ)</label>
      <input id="pPrice" type="number" placeholder="299">

      <label>Stock Quantity</label>
      <input id="pStock" type="number" placeholder="50">
<label>Category</label>
<select id="pCategory">
  <option value="">Select Category</option>
  <option value="indoor">Indoor</option>
  <option value="outdoor">Outdoor</option>
  <option value="succulent">Succulent</option>
  <option value="flowering">Flowering</option>
  <option value="hanging">Hanging</option>
</select>

      
      <label>Description</label>
<input id="pDesc" placeholder="Short plant description">

<label>Care Tips</label>
<textarea id="pCare" rows="4" placeholder="Enter 3 care tips (one per line)"></textarea>

      <label>Image URL</label>
      <input id="pImage" placeholder="https://image-url">

      <button class="inventory-save" onclick="addPlant()">
        Save Plant
      </button>
    </div>

    <!-- LIST CARD -->
    <div class="inventory-card">
      <h3>Plants List</h3>
      <div id="plantsList">Loading plants‚Ä¶</div>
    </div>

  </div>

</div>


<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ================= FIREBASE INIT ================= */
/* ================= FIREBASE INIT (UPDATED) ================= */
firebase.initializeApp({
  apiKey: "AIzaSyCb3NMFbLCBPbbxA2C7J8uMJ5ME2vs-1l4",
  authDomain: "instaplants2.firebaseapp.com",
  projectId: "instaplants2",
  storageBucket: "instaplants2.firebasestorage.app",
  messagingSenderId: "547063766288",
  appId: "1:547063766288:web:49f80da6f1a82fb2f75995",
  measurementId: "G-F1FXSHHJXP"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ================= GLOBALS ================= */
let orders=[];

/* ================= AUTH ================= */
function googleLogin(){
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
    .catch(e=>alert(e.message));
}
function logout(){auth.signOut();}

auth.onAuthStateChanged(user=>{
  if(user){
    login.classList.add("hidden");
    admin.classList.remove("hidden");

    // ‚úÖ DISPLAY ADMIN NAME
    const name = user.displayName || user.email;
    document.getElementById("adminName").innerText =
      "üë§ " + name;

    loadOrders();
  }else{
    admin.classList.add("hidden");
    login.classList.remove("hidden");
  }
});

/* ================= LOAD ORDERS ================= */
function loadOrders(){
  db.collection("orders")
    .orderBy("createdAt", "desc")
    .onSnapshot(snap => {

      orders = [];

      snap.forEach(doc => {
        const d = doc.data();

        orders.push({
          id: doc.id,
          status: d.status || "pending",

          customer: {
            name:
              d.customer?.name ||
              d.name ||
              d.fullName ||
              d.username ||
              d.customerName ||
              "Unknown",

            phone:
              d.customer?.phone ||
              d.phone ||
              d.mobile ||
              d.mobileNumber ||
              d.customerPhone ||
              "N/A",

            email:
              d.customer?.email ||
              d.email ||
              ""
          },

         address: {
  house:
    d.address?.house ||
    d.address?.line1 ||
    d.house ||
    d.flat ||
    "",

  street:
    d.address?.street ||
    d.address?.line2 ||
    d.street ||
    "",

  area:
    d.address?.area ||
    d.locality ||
    "",

  city:
    d.address?.city ||
    d.city ||
    d.shippingAddress?.city ||
    "",

  state:
    d.address?.state ||
    d.state ||
    d.shippingAddress?.state ||
    "",

  pincode:
    d.address?.pincode ||
    d.pincode ||
    d.zip ||
    ""
}
,

          items: Array.isArray(d.items) ? d.items : [],
          totalAmount: d.totalAmount || d.total || 0,
          paymentMethod: d.paymentMethod || d.payment || "N/A"
        });
      });

      updateStats();
      renderOrders();
    });
}

/* ================= STATS ================= */
function updateStats() {
  const active = orders.filter(o => o.status !== "cancelled");

  tTotal.innerText = active.length;
  tPending.innerText = active.filter(o => o.status === "pending").length;
  tAccepted.innerText = active.filter(o => o.status === "accepted").length;
  tShipped.innerText = active.filter(o => o.status === "shipped").length;
  tDelivered.innerText = active.filter(o => o.status === "delivered").length;
}

/* ================= RENDER ================= */
function renderOrders(){
  const q = (search.value || "").toLowerCase();
  const f = filter.value || "all";
  ordersList.innerHTML = "";

  const list = orders.filter(o =>
  (f === "all" || o.status === f) &&
  (
    (o.customer.name || "").toLowerCase().includes(q) ||
    (o.customer.phone || "").includes(q) ||
    (o.id || "").toLowerCase().includes(q) ||          // üîç full Firebase ID
    (o.id || "").slice(0, 8).toLowerCase().includes(q) // üîç short Order ID
  )
);


  if(!list.length){
    ordersList.innerHTML = "<p>No orders found</p>";
    return;
  }

  list.forEach(o=>{
    ordersList.innerHTML += `
      <div class="order">
        <div>
          <strong>Order ID: ${o.id} ¬∑ ‚Çπ${o.totalAmount}</strong>
          <span class="small">
            ${(o.customer.name || "Unknown")} ¬∑ ${(o.customer.phone || "N/A")}
          </span><br>
          <span class="${o.status}">${o.status.toUpperCase()}</span>
 <div class="btns">
  <button class="view" onclick="viewOrder('${o.id}')">View</button>

  ${o.status === "cancelled" ? `
    <span class="rejected">‚ùå Cancelled</span>
  ` : `
    <button class="accept" onclick="updateStatus('${o.id}','accepted')">Accept</button>
    <button class="ship" onclick="updateStatus('${o.id}','shipped')">Ship</button>
    <button class="ship" onclick="updateStatus('${o.id}','delivered')">Delivered</button>
    <button class="reject" onclick="updateStatus('${o.id}','rejected')">Reject</button>
  `}

  <button class="delete" onclick="deleteOrder('${o.id}')">Delete</button>
</div>

      </div>
    `;
  });
}
function downloadOrders(){
  if(!orders.length){
    alert("No orders to download");
    return;
  }

  let csv =
    "Order ID,Customer Name,Phone Number,Status,Total Amount,Payment Method,Items Count\n";

  orders.forEach(o=>{
    csv +=
      `"${o.id}",` +
      `"${o.customer.name || ""}",` +
      `"${o.customer.phone || ""}",` +   // üìû PHONE NUMBER ADDED
      `"${o.status}",` +
      `"${o.totalAmount}",` +
      `"${o.paymentMethod}",` +
      `"${o.items.length}"\n`;
  });

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "instaplant_orders.csv";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}


/* ================= VIEW ================= */
function viewOrder(id){
  const o = orders.find(x=>x.id===id);
  if(!o) return;

  details.innerHTML = `
    <strong>${o.customer.name || "Unknown Customer"}</strong><br>
    üìû ${o.customer.phone || "N/A"}<br>
    üìß ${o.customer.email || ""}<br>
    üìç <strong>delivery address</strong><br>
${o.address.house ? o.address.house + "," : ""}
${o.address.street ? o.address.street + "," : ""}
${o.address.area ? o.address.area + "," : ""}<br>
${o.address.city ? o.address.city + "," : ""}
${o.address.state ? o.address.state + " -" : ""}
${o.address.pincode || ""}<br>
    üí≥ ${o.paymentMethod}<br>
    üí∞ ‚Çπ${o.totalAmount}<br><br>
    <ul>
      ${o.items.length
        ? o.items.map(i=>`<li>${i.name || "Item"} √ó ${i.qty || 1}</li>`).join("")
        : "<li>No items</li>"
      }
    </ul>
  `;
}


/* ================= WHATSAPP ================= */
function sendWhatsApp(o, status) {
  if (!o.customer.phone) {
    alert("Customer phone number missing");
    return;
  }

  const phone = o.customer.phone.replace(/\D/g, "");
  let message = "";

  if (status === "rejected") {
    message =
      `Hello ${o.customer.name || "Customer"} üå±\n` +
      `We regret to inform you that your Instaplant order (ORD-${o.id.slice(0, 8)}) has been *REJECTED*.\n` +
      `This may be due to stock unavailability or delivery constraints.\n\n` +
      `For help, please contact our support.\n` +
      `‚Äì Instaplant Team üåø`;
  } else {
    message =
      `Hello ${o.customer.name || "Customer"} üå±\n` +
      `Your Instaplant order (ORD-${o.id.slice(0, 8)}) has been *${status.toUpperCase()}*.\n` +
      `Thank you for shopping with Instaplant! üåø`;
  }

  const url =
    "https://wa.me/91" +
    phone +
    "?text=" +
    encodeURIComponent(message);

  window.open(url, "_blank");
}

/* ================= UPDATE ================= */
async function updateStatus(id,s){
  const o=orders.find(x=>x.id===id);
  await db.collection("orders").doc(id).update({status:s});
  sendWhatsApp(o,s);
}

/* ================= DELETE ================= */
async function deleteOrder(id){
  if(confirm("Delete order?")){
    await db.collection("orders").doc(id).delete();
  }
}

/* ================= EVENTS ================= */
search.oninput=renderOrders;
filter.onchange=renderOrders;
/* ================= TOGGLE SECTIONS ================= */
function openInventory(){
  document.querySelector(".dashboard").classList.add("hidden");
  inventorySection.classList.remove("hidden");
}

function openOrders(){
  inventorySection.classList.add("hidden");
  document.querySelector(".dashboard").classList.remove("hidden");
}

</script>
<script>
/* ================= PLANTS INVENTORY ================= */
let plants = [];
let editPlantId = null;

/* REALTIME LISTENER */
db.collection("plants")
  .onSnapshot(snap=>{
    plants = [];
    snap.forEach(doc=>{
      plants.push({ id: doc.id, ...doc.data() });
    });
    renderPlants();
  });
const DEFAULT_IMAGES = {
  indoor: "https://images.unsplash.com/photo-1501004318641-b39e6451bec6",
  outdoor: "https://images.unsplash.com/photo-1524594154908-edd18c7f1a1b",
  succulent: "https://images.unsplash.com/photo-1509423350716-97f2360af34e",
  flowering: "https://images.unsplash.com/photo-1498842812179-c81beecf902c",
  plant: "https://images.unsplash.com/photo-1483794344563-d27a8d18014e"
};


/* ADD / UPDATE PLANT */
async function addPlant(){
  try{
const plant = {
  name: pName.value.trim(),
  price: Number(pPrice.value),
  stock: Number(pStock.value),
  category: pCategory.value.trim(),
  image:
  pImage.value.trim() ||
  DEFAULT_IMAGES[pCategory.value.trim().toLowerCase()] ||
  DEFAULT_IMAGES.plant,
  description: pDesc.value.trim(),
careTips: pCare.value
  .split("\n")        // each line admin types
  .map(t => t.trim())
  .filter(Boolean)
  .slice(0, 3)        // üëà ONLY 3 POINTS
  .join(" || "),
   // ‚úÖ NEW
  sameDay: true
};


    if(!plant.name || !plant.price){
      alert("Plant name and price required");
      return;
    }

    if(editPlantId){
      await db.collection("plants").doc(editPlantId).update(plant);
      editPlantId = null;
    }else{
     await db.collection("plants").add({
  ...plant,
  createdAt: firebase.firestore.FieldValue.serverTimestamp()
});
    }

    pName.value = "";
    pPrice.value = "";
    pStock.value = "";
    pCategory.value = "";
    pImage.value = "";
    pCare.value = "";

    alert("‚úÖ Plant saved successfully");

  }catch(err){
    alert("‚ùå Error: " + err.message);
    console.error(err);
  }
}

/* RENDER PLANTS */
function renderPlants(){
  plantsList.innerHTML = "";
  if(!plants.length){
    plantsList.innerHTML="<p>No plants added</p>";
    return;
  }

  plants.forEach(p=>{
    plantsList.innerHTML += `
      <div class="order">
        <div>
          <strong>${p.name}</strong>
          <span class="small">‚Çπ${p.price} ¬∑ Stock: ${p.stock}</span><br>
          <span class="small">${p.category}</span><br>
<span class="small">üåø care: ${p.careTips || "‚Äî"}</span>

        </div>
        <div class="btns">
          <button class="view" onclick="editPlant('${p.id}')">Edit</button>
          <button class="delete" onclick="deletePlant('${p.id}')">Delete</button>
        </div>
      </div>
    `;
  });
}

/* EDIT */
function editPlant(id){
  const p = plants.find(x=>x.id===id);
  if(!p) return;
  editPlantId = id;
  pName.value = p.name;
  pPrice.value = p.price;
  pStock.value = p.stock;
  pCategory.value = p.category;
  pImage.value = p.image;
  pDesc.value = p.description || "";
  pCare.value = p.careTips || "";
}

/* DELETE */
async function deletePlant(id){
  if(confirm("Delete this plant?")){
    await db.collection("plants").doc(id).delete();
  }
}
function openInventory(){
  document.getElementById("inventorySection").classList.remove("hidden");
  document.querySelector(".dashboard").classList.add("hidden");
}

function openOrders(){
  document.getElementById("inventorySection").classList.add("hidden");
  document.querySelector(".dashboard").classList.remove("hidden");
}

</script>

</body>
</html>
